{% extends "base.html" %}

{% block title %}Profile{% endblock %}

{% block main %}
<section class="container-fluid">
  <article class="row justify-content-around p-3">
    <div class="col-12">
      <h1 class="text-center font-weight-light text-primary">–ü—Ä–æ—Ñ—ñ–ª—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞</h1>
    </div>
    <!-- Profile column -->
    <div class="col-12 col-sm-4 col-xl-2">
      <h4 class="py-2 text-center text-primary font-weight-light">
        –ß—É—Ç–ª–∏–≤—ñ –¥–∞–Ω—ñ:
      </h4>
      <div class="row">
        <div class="col-12 text-primary">
          –Ü–º'—è:
        </div>
        <div class="col-12 pb-2">
          {% if user.gender == 'male' %}
            üë®
          {% elseif user.gender == 'female' %}
            üë©
          {% else %}
            ‚ößÔ∏è
          {% endif %}
          {{ user.name }} {{ user.last_name }}
        </div>
        <div class="col-12 text-primary">
          –ï–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞ –ø–æ—à—Ç–∞:
        </div>
        <div class="col-12 pb-2">
            üìß {{ user.email }}
        </div>
        <div class="col-12 text-primary">
          –î–∞—Ç–∞ –Ω–∞—Ä–æ–¥–∂–µ–Ω–Ω—è:
        </div>
        <div class="col-12 pb-2">
          üéÇ {{ user.birth_date|localizeddate('long', 'none', locale) }}
        </div>
        {% if user.car == 1 %}
        <div class="col-12 text-primary">
          –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω–∏–π –∑–∞—Å—ñ–±:
        </div>
        <div class="col-12 pb-2">
          üöó {{ user.car_name }}
        </div>
        {% endif %}
      </div> <!-- 1st Row -->
      <div class="row justify-content-end px-3 py-3">
        <form method="post" action="/profile/edit">
          <button type="submit"
            class="btn btn-sm btn-primary"
          >
            –†–µ–¥–∞–≥—É–≤–∞—Ç–∏
          </button>
        </form>
        <!-- Button trigger modal -->
        <button type="button"
          class="btn btn-sm btn-outline-danger ml-2"
          data-toggle="modal"
          data-target="#confirmDeleteModal"
          {% if current_user.id == '1' %}
            disabled
          {% endif %}
        >
          –í–∏–¥–∞–ª–∏—Ç–∏
        </button>
        {% include 'Profile/modal.html' %}
      </div>
      {% if current_user.id == '1' %}
        <div class="p-2 border border-danger rounded text-danger text-center">
          –í–∏ –Ω–µ –º–æ–∂–µ—Ç–µ –≤–∏–¥–∞–ª–∏—Ç–∏ —Ü–µ–π –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü—ñ–π–Ω–∏–π –ø—Ä–æ—Ñ—ñ–ª—å
        </div>
      {% endif %}
    </div><!-- End of profile display column -->

    <!-- Routes display column -->
    <div class="col-12 col-sm-8 col-xl-6">
    {% if routes is not empty %}
    <!-- Driver routes -->
      <h4 class="py-2 text-center text-primary font-weight-light">
        –í–∞—à—ñ –º–∞—Ä—à—Ä—É—Ç–∏ —è–∫ –≤–æ–¥—ñ—è
      </h4>
      {% for route in routes %}
        <div class="row row-highlight py-2">
          <!-- Departure -->
          <div class="col-4 col-sm-2 py-2 align-self-center">
            <small>{{ route.departure|localizeddate('long', 'none', locale) }}</small>
          </div>
          <!-- Origin {{ county|join(' ')}}-->
          <div class="col-4 col-sm-2 px-0 py-2 align-self-center text-dark font-weight-bold">
            {% set shortOrigin = route.origin|split(' ') %}
            {% set city = shortOrigin|slice(0,2) %}
            {{ city|join(' ') }}
          </div>
          <!-- Destination -->
          <div class="col-4 col-sm-3 px-0 py-2 align-self-center text-secondary font-weight-bold">
            {% set shortDestination = route.destination|split(' ') %}
            {% set city = shortDestination|slice(0,2) %}
            {{ city|join(' ') }}
          </div>
          <!-- Seats -->
          {% set freeSeats = route.pax_capacity - route.occupied %}
          <div class="col-6 col-sm-2 py-2 align-self-center">
            <small>
              <a href="/routes/details?routeId={{ route.id }}">
                –ú—ñ—Å—Ü—å: {{ freeSeats }} –∑ {{ route.pax_capacity }}
              </a>
            </small>
          </div>
          <!-- Buttons -->
          <div class="col-6 col-sm-3 py-2 px-0 pr-3 d-flex align-items-center justify-content-end">
            <a tabindex="0" role="button"
              class="btn btn-sm btn-outline-primary popover-dismiss mr-2"
              data-toggle="popover"
              data-trigger="focus"
              title="{{ route.name }} {{ route.last_name }} to {{ destination|first }}"
              data-content="–í—ñ–¥'—ó–∂–¥–∂–∞—î
              {{ route.departure|localizeddate('long', 'none', locale) }}
                –≤—ñ–¥ {{ route.origin }} –¥–æ {{ route.destination }}
                –∑ {{ route.occupied }}  –ø–∞—Å–∞–∂–∏—Ä{{ route.occupied == 1 ? '–æ–º' : '–∞–º–∏'}}."
            >
              –î–µ—Ç–∞–ª—ñ
            </a>
            <form class="form-inline" method="post" action="/routes/delete?id={{ route.id }}">
              <button type="submit"
                class="btn btn-sm btn-outline-danger"
              >
                –í–∏–¥–∞–ª–∏—Ç–∏
              </button>
            </form>
          </div>
        </div>
      {% endfor %}
      {% endif %}
      {% if passenger_routes is not empty %}
      <!-- Passenger routes -->
        <h4 class="py-2 text-center text-primary font-weight-light">
          –í–∞—à—ñ –ø–∞—Å–∞–∂–∏—Ä—Å—å–∫—ñ –º–∞—Ä—à—Ä—É—Ç–∏
        </h4>
        {% for route in passenger_routes %}
          <div class="row row-highlight py-2">
            <div class="col-4 col-sm-2 align-self-center">
              <small>{{ route.departure|localizeddate('long', 'none', locale) }}</small>
            </div>
            <!-- Origin -->
            <div class="col-4 col-sm-2 px-0 py-2 align-self-center text-dark font-weight-bold">
              {% set origin = route.origin|split(' ') %}
              {{ origin|first }}
            </div>
            <!-- Destination -->
            <div class="col-4 col-sm-3 px-0 py-2 align-self-center text-secondary font-weight-bold">
              {% set destination = route.destination|split(' ') %}
              {{ destination|first }}
            </div>
            <!-- Seats and drivers name -->
            {% set freeSeats = route.pax_capacity - route.occupied %}
            <div class="col-6 col-sm-2 py-2 align-self-center">
              <small>
                {{ route.driver_name }} {{ route.driver_last_name }}
              </small>
              <br />
              <small>
                <a href="/routes/details?routeId={{ route.id }}"
                  title="–°–ø–∏—Å–æ–∫ –ø–∞—Å–∞–∂–∏—Ä—ñ–≤!"
                >
                  –ú—ñ—Å—Ü—å: {{ freeSeats }} –∑ {{ route.pax_capacity }}
                </a>
              </small>
            </div>
            <!-- Buttons -->
            <div class="col-6 col-sm-3 py-2 px-0 pr-3 d-flex align-items-center justify-content-end">
              <a tabindex="0" role="button"
                class="btn btn-sm btn-outline-primary popover-dismiss mr-2"
                data-toggle="popover"
                data-trigger="focus"
                title="{{ route.driver_name }} {{ route.driver_last_name }} to {{ destination|first }}"
                data-content="–í—ñ–¥'—ó–∂–¥–∂–∞—î
                  {{ route.departure|localizeddate('long', 'none', locale) }}
                  –≤—ñ–¥ {{ route.origin }} –¥–æ {{ route.destination }}
                  –∑ {{ route.occupied }}  –ø–∞—Å–∞–∂–∏—Ä{{ route.occupied == 1 ? '–æ–º' : '–∞–º–∏'}}."
              >
                –î–µ—Ç–∞–ª—ñ
              </a>
              <form class="form-inline" method="post" action="/routes/removePassenger?routeId={{ route.id }}">
                <button type="submit"
                  class="btn btn-sm btn-outline-danger"
                >
                  –í–∏–¥–∞–ª–∏—Ç–∏
                </button>
              </form>
            </div>
          </div>
        {% endfor %}
      {% endif %}
      </div>
  </article>
</section>
{% endblock %}
